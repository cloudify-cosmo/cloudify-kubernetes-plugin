tosca_definitions_version: cloudify_dsl_1_3

imports:
  - https://cloudify.co/spec/cloudify/6.2.0/types.yaml
  - plugin:cloudify-kubernetes-plugin

inputs:

  resource_path:
    display_label: Resource Path
    type: string
    default: resources/crd.yaml

  validate_status:
    display_label: Validate Status
    type: boolean
    default: false

  allow_node_redefinition:
    display_label: Allow Node Redefinition
    type: boolean
    default: true

  resource_template_variables:
    display_label: Resource Template Variables
    type: dict
    default: {}

  resource_group_name:
    display_label: Resource Group Name
    type: string

  cluster_name:
    display_label: Cluster Name
    type: string

node_templates:

  resource:
    type: cloudify.nodes.kubernetes.resources.FileDefinedResource
    properties:
      client_config:
        authentication:
          azure_service_account:
            resource_group_name: { get_input: resource_group_name }
            cluster_name: { get_input: cluster_name }
            subscription_id: { get_secret: azure_subscription_id }
            tenant_id: { get_secret: azure_tenant_id }
            client_id: { get_secret: azure_client_id }
            client_secret: { get_secret: azure_client_secret }
      validate_resource_status: { get_input: validate_status }
      allow_node_redefinition: { get_input: allow_node_redefinition }
      file:
        resource_path: { get_input: resource_path }
        template_variables: { get_input: resource_template_variables }
